<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Reporte de Evento</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #121212;
      color: #fff;
      padding: 20px;
    }
    form {
      max-width: 500px;
      margin: auto;
      background: #1e1e1e;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 0 10px rgba(255,255,255,0.1);
    }
    label {
      display: block;
      margin-top: 10px;
    }
    input, select, textarea, button {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      border-radius: 8px;
      border: none;
      font-size: 15px;
    }
    button {
      background: #25d366;
      color: #fff;
      font-weight: bold;
      cursor: pointer;
      margin-top: 15px;
    }
    button:hover {
      background: #1ebe5d;
    }
  </style>
</head>
<body>

  <form id="formularioReporte">
    <h2>ðŸ“‹ Reporte de Evento</h2>

    <label>Fecha del evento:</label>
    <input type="date" id="fechaEvento" required>

    <label>Unidad:</label>
    <input type="text" id="unidad">

    <label>Gerente:</label>
    <input type="text" id="gerente">

    <label>Driver:</label>
    <input type="text" id="driver">

    <label>TelÃ©fono:</label>
    <input type="tel" id="telefono">

    <label>Tienda:</label>
    <input type="text" id="tienda">

    <label>Ciudad / AlcaldÃ­a:</label>
    <input type="text" id="ciudad">

    <label>Proyecto:</label>
    <input type="text" id="proyecto">

    <label>Seguro:</label>
    <select id="seguro">
      <option value="SÃ­">SÃ­</option>
      <option value="No">No</option>
    </select>

    <label>DescripciÃ³n:</label>
    <textarea id="descripcion" rows="3"></textarea>

    <button type="button" onclick="enviarDatos()">ðŸ“¤ Generar folio y enviar</button>
  </form>

  <script>
    // ================= FUNCIONES PRINCIPALES =================

    function generarFolio() {
      const random = Math.floor(Math.random() * 9999).toString().padStart(4, "0");
      return `FOL-${random}`;
    }

    async function enviarDatos() {
      const folio = generarFolio();
      const fechaEvento = document.getElementById("fechaEvento").value;
      const unidad = document.getElementById("unidad").value;
      const gerente = document.getElementById("gerente").value;
      const driver = document.getElementById("driver").value;
      const telefono = document.getElementById("telefono").value;
      const tienda = document.getElementById("tienda").value;
      const ciudad = document.getElementById("ciudad").value;
      const proyecto = document.getElementById("proyecto").value;
      const seguro = document.getElementById("seguro").value;
      const descripcion = document.getElementById("descripcion").value;

      // Fecha y hora de envÃ­o
      const fechaEnvio = new Date();
      const enviado = fechaEnvio.toLocaleString("es-MX", { dateStyle: "short", timeStyle: "medium" });

      // ðŸŸ© RESUMEN DE WHATSAPP
      const resumen = `ðŸ“‹ *Reporte de Evento*\n\n` +
        `ðŸ§¾ *Folio:* ${folio}\n` +
        `ðŸ“… *Fecha del evento:* ${fechaEvento || "No especificada"}\n` +
        `â° *Enviado:* ${enviado}\n\n` +
        `ðŸš— *Unidad:* ${unidad || "-"}\n` +
        `ðŸ‘¨â€ðŸ’¼ *Gerente:* ${gerente || "-"}\n` +
        `ðŸ‘·â€â™‚ï¸ *Driver:* ${driver || "-"}\n` +
        `ðŸ“ž *Tel:* ${telefono || "-"}\n` +
        `ðŸª *Tienda:* ${tienda || "-"}\n` +
        `ðŸ“ *Ciudad:* ${ciudad || "-"}\n` +
        `ðŸ“ *Proyecto:* ${proyecto || "-"}\n` +
        `ðŸ›¡ï¸ *Seguro:* ${seguro}\n\n` +
        `ðŸ“ *DescripciÃ³n:*\n${descripcion || "(sin descripciÃ³n)"}\n`;

      // ðŸŸ¨ EnvÃ­o a Google Sheets (opcional)
      // const formData = new FormData();
      // formData.append("folio", folio);
      // formData.append("fechaEvento", fechaEvento);
      // formData.append("unidad", unidad);
      // formData.append("gerente", gerente);
      // formData.append("driver", driver);
      // formData.append("telefono", telefono);
      // formData.append("tienda", tienda);
      // formData.append("ciudad", ciudad);
      // formData.append("proyecto", proyecto);
      // formData.append("seguro", seguro);
      // formData.append("descripcion", descripcion);
      // formData.append("fechaEnvio", enviado);
      // await fetch("TU_URL_DE_GOOGLE_APPS_SCRIPT", { method: "POST", body: formData });

      alert(`âœ… Reporte generado correctamente.\n\nFolio asignado: ${folio}`);

      // Abrir WhatsApp con fallback
      await abrirWhatsAppConFallback(resumen);
    }

    // ================= FUNCIÃ“N DE ENVÃO A WHATSAPP (CON FALLBACK iOS/ANDROID) =================

    async function abrirWhatsAppConFallback(resumen) {
      const encoded = encodeURIComponent(resumen);
      const appUrl = `whatsapp://send?text=${encoded}`;
      const webUrl = `https://api.whatsapp.com/send?text=${encoded}`;
      const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
      const isAndroid = /Android/.test(navigator.userAgent);

      try {
        if (isIOS) {
          window.location.href = appUrl;
          setTimeout(() => window.open(webUrl, "_blank"), 1200);
          return;
        }
        if (isAndroid) {
          const win = window.open(appUrl, "_blank");
          setTimeout(() => {
            if (!win) window.open(webUrl, "_blank");
          }, 900);
          return;
        }
        window.open(webUrl, "_blank");
      } catch (err) {
        console.warn("Error WhatsApp:", err);
        try {
          await copiarAlPortapapeles(resumen);
          alert("ðŸ“‹ Mensaje copiado. Abriendo WhatsApp...");
        } catch {
          alert("No se pudo copiar. Pega el mensaje manualmente.");
        }
        window.open(webUrl, "_blank");
      }
    }

    async function copiarAlPortapapeles(texto) {
      if (navigator.clipboard) return navigator.clipboard.writeText(texto);
      const ta = document.createElement("textarea");
      ta.value = texto;
      document.body.appendChild(ta);
      ta.select();
      document.execCommand("copy");
      document.body.removeChild(ta);
    }
  </script>
</body>
</html>

