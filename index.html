<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Reporte de Evento</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f0f4f8;
      color: #222;
      padding: 20px;
    }
    form {
      max-width: 500px;
      margin: auto;
      background: #ffffff;
      padding: 25px;
      border-radius: 12px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }
    h2 {
      text-align: center;
      color: #0077b6;
    }
    label {
      display: block;
      margin-top: 10px;
      font-weight: bold;
    }
    input, select, textarea, button {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 15px;
      background-color: #f9fafb;
    }
    button {
      background: #0077b6;
      color: #fff;
      font-weight: bold;
      cursor: pointer;
      margin-top: 15px;
      border: none;
      transition: background 0.3s;
    }
    button:hover {
      background: #005b8f;
    }
  </style>
</head>
<body>

  <form id="formularioReporte">
    <h2>📋 Reporte de Evento</h2>

    <label>Fecha del evento:</label>
    <input type="date" id="fechaEvento" required>

    <label>Hora del suceso:</label>
    <input type="time" id="horaEvento" required>

    <label>Unidad:</label>
    <input type="text" id="unidad">

    <label>Gerente:</label>
    <input type="text" id="gerente">

    <label>Driver:</label>
    <input type="text" id="driver">

    <label>Teléfono:</label>
    <input type="tel" id="telefono">

    <label>Tienda:</label>
    <input type="text" id="tienda">

    <label>Ciudad / Alcaldía:</label>
    <input type="text" id="ciudad">

    <label>Proyecto:</label>
    <input type="text" id="proyecto">

    <label>Seguro:</label>
    <select id="seguro">
      <option value="Sí">Sí</option>
      <option value="No" selected>No</option>
    </select>

    <label>Descripción:</label>
    <textarea id="descripcion" rows="3"></textarea>

    <button type="button" onclick="enviarDatos()">📤 Generar folio y enviar</button>
  </form>

  <script>
    // Generar folio aleatorio
    function generarFolio() {
      const random = Math.floor(Math.random() * 9999).toString().padStart(4, "0");
      return `FOL-${random}`;
    }

    // Enviar datos y abrir WhatsApp
    async function enviarDatos() {
      const folio = generarFolio();
      const fechaEvento = document.getElementById("fechaEvento").value;
      const horaEvento = document.getElementById("horaEvento").value;
      const unidad = document.getElementById("unidad").value;
      const gerente = document.getElementById("gerente").value;
      const driver = document.getElementById("driver").value;
      const telefono = document.getElementById("telefono").value;
      const tienda = document.getElementById("tienda").value;
      const ciudad = document.getElementById("ciudad").value;
      const proyecto = document.getElementById("proyecto").value;
      const seguro = document.getElementById("seguro").value;
      const descripcion = document.getElementById("descripcion").value;

      // Fecha y hora del envío
      const fechaEnvio = new Date();
      const enviado = fechaEnvio.toLocaleString("es-MX", { dateStyle: "short", timeStyle: "medium" });

      // Resumen del mensaje
      const resumen = `📋 *Reporte de Evento*\n\n` +
        `🧾 *Folio:* ${folio}\n` +
        `📅 *Fecha del evento:* ${fechaEvento || "No especificada"}\n` +
        `🕒 *Hora del suceso:* ${horaEvento || "No indicada"}\n` +
        `⏰ *Enviado:* ${enviado}\n\n` +
        `🚗 *Unidad:* ${unidad || "-"}\n` +
        `👨‍💼 *Gerente:* ${gerente || "-"}\n` +
        `👷‍♂️ *Driver:* ${driver || "-"}\n` +
        `📞 *Tel:* ${telefono || "-"}\n` +
        `🏪 *Tienda:* ${tienda || "-"}\n` +
        `📍 *Ciudad:* ${ciudad || "-"}\n` +
        `📁 *Proyecto:* ${proyecto || "-"}\n` +
        `🛡️ *Seguro:* ${seguro}\n\n` +
        `📝 *Descripción:*\n${descripcion || "(sin descripción)"}\n`;

      alert(`✅ Reporte generado.\n\nFolio asignado: ${folio}`);

      await abrirWhatsAppConFallback(resumen);
    }

    // Envío a WhatsApp con compatibilidad para Android/iOS/Web
    async function abrirWhatsAppConFallback(resumen) {
      const encoded = encodeURIComponent(resumen);
      const appUrl = `whatsapp://send?text=${encoded}`;
      const webUrl = `https://api.whatsapp.com/send?text=${encoded}`;
      const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
      const isAndroid = /Android/.test(navigator.userAgent);

      try {
        if (isIOS) {
          window.location.href = appUrl;
          setTimeout(() => window.open(webUrl, "_blank"), 1200);
          return;
        }
        if (isAndroid) {
          const win = window.open(appUrl, "_blank");
          setTimeout(() => {
            if (!win) window.open(webUrl, "_blank");
          }, 900);
          return;
        }
        window.open(webUrl, "_blank");
      } catch (err) {
        console.warn("Error WhatsApp:", err);
        await copiarAlPortapapeles(resumen);
        alert("📋 Mensaje copiado. Abriendo WhatsApp...");
        window.open(webUrl, "_blank");
      }
    }

    async function copiarAlPortapapeles(texto) {
      if (navigator.clipboard) return navigator.clipboard.writeText(texto);
      const ta = document.createElement("textarea");
      ta.value = texto;
      document.body.appendChild(ta);
      ta.select();
      document.execCommand("copy");
      document.body.removeChild(ta);
    }
  </script>
</body>
</html>
